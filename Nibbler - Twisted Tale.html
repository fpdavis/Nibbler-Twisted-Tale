<HTML>
<HEAD>
    <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type">

    <TITLE>Nibbler - Twisted Tale</TITLE>
    <script type="text/javascript" src="Nibbler - Twisted Tale.js" defer="defer"></script>
    <script type="text/javascript" src="Pathfinder.js"></script>
    <script type="text/javascript" src="MazeGenerator.js"></script>
    <script type="text/javascript" src="astar.js"></script>
    <script type="text/javascript" src="MessageLog.js"></script>
</HEAD>

<BODY>

    <STYLE>
        html, body {
            width: 100%;
            height: 100%;
            margin: 0;
            border: 0;
            overflow: hidden; /*  Disable scrollbars */
            display: block;
            background-color: #000;
            cursor: crosshair;
        }

        .wrapper {
            display: grid;
            border: 1px solid #000;
            grid-gap: 10px;
            grid-template-columns: repeat(auto-fit, minmax(200px,1fr));
        }

        .box {
            background-color: #000;
            color: #fff;
            padding: 10px;
            font-size: 150%
        }

        .blink_me {
            animation: blinker 1s linear infinite;
        }

        .dead {
            color: dimgray;
        }

        @keyframes blinker {
            50% {
                opacity: 0;
            }
        }

        input[type="color"] {
            -webkit-appearance: none;
            border: none;
            width: 22px;
            height: 22px;
        }

            input[type="color"]::-webkit-color-swatch-wrapper {
                padding: 0;
            }

            input[type="color"]::-webkit-color-swatch {
                border: none;
            }
    </STYLE>
    <div id="divScoreboard">
        <div class="wrapper">
            <div class="box"><input id="colorPlayer1" type="color" value="#00FF00" onchange="oColorMenuPlayer[0].value = ogPlayer[0].fillStyle = this.value;"> <span id="spanPlayer1">Player 1 (-) 000</span></div>
            <div class="box"><input id="colorPlayer3" type="color" value="#0000FF" onchange="oColorMenuPlayer[2].value = ogPlayer[2].fillStyle = this.value;">&nbsp;<span id="spanPlayer3">Player 3 (-) 000</span></div>
            <div id="divTime" class="box blink_me">TIME ---</div>
        </div>
        <div class="wrapper">
            <div class="box"><input id="colorPlayer2" type="color" value="#FF0000" onchange="oColorMenuPlayer[1].value = ogPlayer[1].fillStyle = this.value;">&nbsp;<span id="spanPlayer2">Player 2 (-) 000</span></div>
            <div class="box"><input id="colorPlayer4" type="color" value="#FFFF00" onchange="oColorMenuPlayer[3].value = ogPlayer[3].fillStyle = this.value;">&nbsp;<span id="spanPlayer4">Player 4 (-) 000</span></div>
            <div id="divHighScore" class="box">HIGHSCORE (Player -) 000</div>
        </div>
    </div>


    <canvas id="canArena"></canvas>


    <style>
        svg {
            width: 560px;
            position: relative;
            height: 380px;
            margin: 0 auto;
            display: block;
        }

            svg line {
                stroke-width: 2px;
                stroke: rgba(2,162,239,1);
            }

            svg #svg_2 {
                stroke-dasharray: 1680;
                stroke-dashoffset: 1680;
            }

            svg #svg_4 {
                stroke-dasharray: 1680;
                stroke-dashoffset: -380;
            }

            svg #svg_3 {
                stroke-dasharray: 1680;
                stroke-dashoffset: -580;
            }

            svg #svg_5 {
                stroke-dasharray: 1680;
                stroke-dashoffset: -380;
            }

        @keyframes anim-dash {
            90% {
                stroke: rgba(2,162,239,1);
            }

            100% {
                stroke: #ffffff;
                stroke-dashoffset: 0;
                opacity: 1;
            }
        }

        .overlay {
            background: rgba(0,0,0,.5);
            width: 100%;
            height: 100%;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            z-index: -999;
        }

        .modal {
            position: absolute;
            width: 560px;
            height: 380px;
            top: 50%;
            left: 70%;
            transform: translate(-100%,-40%);
        }

        .modal-inner {
            position: absolute;
            top: 3px;
            left: 3px;
            width: 542px;
            height: 365px;
            color: #ffffff;
            background-color: rgba(60, 60, 60, 0.4);
            opacity: 0;
            margin: 5px;
        }

        .modal-start {
            float: right;
            z-index: +2;
            color: #424242;
            margin: 5px 5px 0 0;
            font-size: 20px;
            font-weight: bold;
            text-decoration: none;
            text-align: center;
            line-height: 20px;
        }

        .modal-inner h3 {
            text-align: center;
            font-size: 22px;
            position: relative;
            top: -15px
        }

        .modal-blur {
            -webkit-filter: blur(2px);
            -moz-filter: blur(2px);
            -o-filter: blur(2px);
            -ms-filter: blur(2px);
            filter: blur(2px);
        }

        .showGameMenu .modal, .showGameMenu {
            animation: display .6s forwards;
            z-index: auto;
        }

            .showGameMenu .modal svg line {
                animation: anim-dash .6s forwards;
                animation-delay: .6s;
            }

            .showGameMenu .modal .modal-inner {
                animation: display .6s forwards;
                animation-delay: 1s;
            }

        @keyframes display {
            to {
                opacity: 1;
            }
        }

        .menuwrapper {
            display: grid;
            border: 1px solid #000000;
            grid-gap: 5px;
            grid-template-columns: 271px 271px;
        }

        .menuheader {
            grid-column: 1 / span 2;
            grid-row: 1;
            font-size: 90%;
            height: 30px;
            border: 1px solid #000;
        }

        .menucolumn1 {
            grid-column: 1;
            grid-row: 2;
            font-size: 90%;
            border: 1px solid #000;
        }

        .menucolumn2 {
            grid-column: 2;
            grid-row: 2;
            font-size: 90%;
            border: 1px solid #000;
        }

        .menucolumn3 {
            grid-column: 1;
            grid-row: 3;
            font-size: 90%;
            border: 1px solid #000;
        }

        .menucolumn4 {
            grid-column: 2;
            grid-row: 3;
            font-size: 90%;
            border: 1px solid #000;
        }

        .menufooter {
            grid-column: 1 / span 2;
            grid-row: 4;
            font-size: 90%;
            border: 1px solid #000;
        }
    </style>

    <div class="overlay" id="divGameMenu">
        <div class="modal">
            <svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="0 0 560 380" preserveAspectRatio="none">
                <line id="svg_3" fill="none" stroke="#000000" stroke-width="2" x1="2.0" y1="2.0" x2="558" y2="2.0" />
                <line id="svg_4" fill="none" stroke="#000000" stroke-width="2" x1="558" y1="378" x2="558" y2="2.0" />
                <line id="svg_2" fill="none" stroke="#000000" stroke-width="2" x1="2.0" y1="378" x2="558" y2="378" />
                <line id="svg_5" fill="none" stroke="#000000" stroke-width="2" x1="2.0" y1="2.0" x2="2.0" y2="378" />
            </svg>
            <div class="modal-inner menuwrapper">
                <div class="menuheader">
                    <h3>Game Options</h3>
                </div>
                <div class="menucolumn1">
                    <input id="colorMenuPlayer1" type="color" value="#00FF00" onchange="oColorPlayer[0].value = ogPlayer[0].fillStyle = this.value;" style="vertical-align: middle;">
                    <select id="selectPlayer1"><option selected>Human</option><option>Computer</option></select>
                    <input id="txtPlayer1Name" type="text" placeholder="Player 1" maxlength="10" size="10" />

                    <br />
                    <input id="colorMenuPlayer2" type="color" value="#FF0000" onchange="oColorPlayer[1].value = ogPlayer[1].fillStyle = this.value;" style="vertical-align: middle;">
                    <select id="selectPlayer2"><option>Human</option><option>Computer</option><option selected>None</option></select>
                    <input id="txtPlayer2Name" type="text" placeholder="Player 2" maxlength="10" size="10" />
                    <br />
                    <br />Lives:
                    <input type="range" id="rangeLives" min="1" max="10" value="3" oninput="this.nextElementSibling.value=this.value" style="vertical-align: middle;" />
                    <input type="number" id="numberLives" min="1" max="10" value="3" style="width: 33px" oninput="this.previousElementSibling.value=this.value" />

                    <br />Speed: <select id="selectSpeed"><option>Slow</option><option selected>Normal</option><option>Fast</option></select>
                </div>
                <div class="menucolumn3">
                    <input type="checkbox" id="chkDiagonalMovement" />Diagonal Movement
                    <br /><input type="checkbox" id="chkWallWrap" checked="checked" oninput="if (this.checked) {chkDeadlyWalls.checked = false }" />Wall Wrap
                    <br /><input type="checkbox" id="chkMaze" />Maze
                    <br /><input type="checkbox" id="chkNonStop" checked="checked" />Non-stop
                </div>

                <div class="menucolumn2">
                    <input id="colorMenuPlayer3" type="color" value="#0000FF" onchange="oColorPlayer[2].value = ogPlayer[2].fillStyle = this.value;" style="vertical-align: middle;">
                    <select id="selectPlayer3"><option>Human</option><option>Computer</option><option selected>None</option></select>
                    <input id="txtPlayer3Name" type="text" placeholder="Player 3" maxlength="10" size="10" />

                    <br />
                    <input id="colorMenuPlayer4" type="color" value="#FFFF00" onchange="oColorPlayer[3].value = ogPlayer[3].fillStyle = this.value;" style="vertical-align: middle;">
                    <select id="selectPlayer4"><option>Human</option><option>Computer</option><option selected>None</option></select>
                    <input id="txtPlayer4Name" type="text" placeholder="Player 4" maxlength="10" size="10" />
                    <br /><br />
                    Arena Size: <select id="selectArenaSize"><option>Small</option><option selected>Medium</option><option>Large</option></select>
                    <br /><span style="margin-left: 8px;">
                        <input type="checkbox" id="chkTime" checked="checked" oninput="numberTime.disabled = !this.checked " />Timer:
                        <input type="number" id="numberTime" min="30" max="480" value="120" step="10" style="width: 72px" />
                    </span>
                </div>
                <div class="menucolumn4">
                    <input type="checkbox" id="chkDeadlyTails" checked="checked" />Deadly Tails
                    <br /><input type="checkbox" id="chkDeadlyWalls" oninput="if (this.checked) {chkWallWrap.checked = false }" />Deadly Walls
                    <br /><input type="checkbox" id="chkInfiniteTails" />Infinite Tails
                    <br /><input type="checkbox" id="chkEnemies" checked="checked" />Enemies
                </div>
                <div class="menufooter">
                    <span style="margin-left: 5px;">
                        Music Volume: [-]
                        <input type="range" id="rangeMusicVolume" min="0" max="1" step=".1" value=".5"
                               oninput="Music.One.volume=Music.Volume=this.value" style="vertical-align: middle;" /> [+]
                        (<input type="checkbox" id="chkMuteMusic"
                                oninput="Music.NotMuted=!this.checked; if (this.checked) { Music.One.pause() } else { Music.One.play();}" style="vertical-align: middle;" />[M]ute)
                    </span>
                    <br />Effects Volume: [-]
                    <input type="range" id="rangeEffectsVolume" min="0" max="1" step=".1" value=".8"
                           oninput="Sounds.Volume=this.value" style="vertical-align: middle;" /> [+]
                    (<input type="checkbox" id="chkMuteEffects" oninput="Sounds.NotMuted=!this.checked" style="vertical-align: middle;" />[M]ute)

                    <input type="button" id="btnStart" Value="Start" class="modal-start" onclick="StartGame();" />
                    <br /><br />
                    <div style="background: coral; opacity: .5; text-align: center; width: 542px;"> Hit [Esc] or [p] to Pause Game</div>
                </div>
            </div>
        </div>
    </div>
</BODY>
</HTML>